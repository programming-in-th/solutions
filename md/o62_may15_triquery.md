ข้อนี้มีวิธีทำได้หลายวิธี แต่วิธีที่จะนำเสนอเป็นวิธีที่ผู้เขียนคิดว่าตรงไปตรงมาที่สุด

เริ่มต้นเราจะกำหนดการอ้างอิงตำแหน่งบนตารางเป็นแบบ 1-indexed (เริ่มต้นที่ 1) และจะนิยามแนวแทยงแนวหนึ่งเป็นทุก ๆ ช่องที่มีผลรวมของตำแหน่งแถวและหลักเป็นค่าเดียวกัน (นั่นคือ แนวแทยงคือช่องที่มี $D = i+j$ เท่ากัน โดย $2 \leq D \leq 2N$) 

จากนั้นเราจะนิยาม $f(D, b)$ เป็นผลรวมของสี่เหลี่ยมดังรูปด้านล่าง นั่นคือ $f(D, b)$ จะมีค่าเท่ากับ ผลรวมของทุก ๆ ช่อง $(x, y)$ ที่ $x+y \geq D$ และ $y \leq b$ โดยที่ถ้า $x+y = D$ ให้หาบวกแค่ครึ่งเดียว

![](https://raw.githubusercontent.com/programming-in-th/solutions/master/media/o62_may15_triquery/001.png)

สังเกตว่า คำตอบของคำถาม